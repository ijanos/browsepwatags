<html>
    <head>
        <title>Browse PWA tags</title>
        
         <link rel="stylesheet" href="css/index.css" type="text/css" />
         <link rel="stylesheet" href="css/css3buttons.css" type="text/css" />

        <script type="text/javascript"
         src="//ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
        <script type="text/javascript" src="js/jquery.quicksearch.js"></script>

        <script type="text/javascript">
            var CurrentTagFilter = []

            var updateTagStrip = function(){
                 var cTag = CurrentTagFilter[CurrentTagFilter.length-1];
                 $.getJSON('t/' + cTag, function(imgs) {
                    var items = [];

                    $.each(imgs, function(i) {
                        items.push(
                            '<a href="'  + imgs[i].original  + '">' +
                            '<img src="' + imgs[i].thumbnail + '"></img></a>');
                    });

                    $("#photos").append(items.join(''))
                });

                 $("#tagstrip")
                  .append('<a href="#" class="button"><span class="tag icon"></span>' + cTag + '</a>');

            };

            var addTag = function(tag){
                CurrentTagFilter.push(tag)
                updateTagStrip();
            };
          $(document).ready(function() {
                  $(CurrentTagFilter).change(function(){
                        alert(omg)
                      })

             $('#loadingdiv')
                .hide()  // hide it initially
                .ajaxStart(function() {
                    $(this).show();
                })
                .ajaxStop(function() {
                    $(this).hide();
                });


             $.getJSON('tags', function(tags) {
                var items = [];

                tags.sort(function(a,b){
                 return b.weight - a.weight;
                });

                $.each(tags, function(i) {
                    items.push('<tr class="tagtr"><td class ="tagname">'
                         + tags[i].name + '</td><td>' + tags[i].weight + '</td></tr>');
                });

                $("#tagtable").html(items.join(''))

                $('input#search').quicksearch('table#tagtable tr');

                 $(".tagtr").click(function(){
                    var tagname = $('td.tagname',this).html()
                    addTag(tagname)
                 });
            });



          });
        </script>
    </head>

  <body>

    <div id="loadingdiv">L O A D I N G</div>

    <div id="navbar">
         <div class="left">
            Hello {{ usernick }} 
            {% if needpicasaauth %}
            <a href="{{ needpicasaauth }}" class="button">Get Picasa token</a> 
            {% endif %} 
         </div>

         <div class="right">
            <a href="{{ signout }}" class="negative button">Log out</a>
         </div>
    </div>

    <div id="main">
        <div id="tags">
            <form action="#">
                <input type="text" id="search" autocomplete="off" placeholder="Search">
            </form>
            <table id="tagtable"></table>
        </div>
        <div id="tagstrip">
        </div>
        <div id="photos">
        </div>
    </div>

  </body>
{% comment %} vim: set filetype=htmldjango : {% endcomment %}
</html>
